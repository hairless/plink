(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6773f6c4","chunk-2b2f78a5","chunk-2d0d7a0b","chunk-2d2093fb","chunk-2d0d78d4"],{"4fad":function(t,e,a){var s=a("23e7"),i=a("6f53").entries;s({target:"Object",stat:!0},{entries:function(t){return i(t)}})},"6f53":function(t,e,a){var s=a("83ab"),i=a("df75"),n=a("fc6a"),o=a("d1e7").f,r=function(t){return function(e){var a,r=n(e),l=i(r),d=l.length,u=0,c=[];while(d>u)a=l[u++],s&&!o.call(r,a)||c.push(t?[a,r[a]]:r[a]);return c}};t.exports={entries:r(!0),values:r(!1)}},"76fe":function(t,e,a){"use strict";a.r(e),a.d(e,"UPLOAD_JAR_URL",(function(){return i})),a.d(e,"getJobPageList",(function(){return n})),a.d(e,"addJob",(function(){return o})),a.d(e,"getJob",(function(){return r})),a.d(e,"updateJob",(function(){return l})),a.d(e,"deleteJob",(function(){return d})),a.d(e,"deleteJobList",(function(){return u})),a.d(e,"getJobJarList",(function(){return c})),a.d(e,"startJob",(function(){return g})),a.d(e,"startJobList",(function(){return p})),a.d(e,"restartJob",(function(){return h})),a.d(e,"restartJobList",(function(){return f})),a.d(e,"stopJob",(function(){return m})),a.d(e,"stopJobList",(function(){return b}));a("ac1f"),a("5319");var s=a("b775"),i="/mng/job/{jobId}/uploadJar";function n(t){return Object(s["default"])({url:"/mng/job/queryJobs",method:"get",params:t})}function o(t){return Object(s["default"])({url:"/mng/job/addJob",method:"post",data:t})}function r(t){return Object(s["default"])({url:"/mng/job/queryJob/"+t,method:"get"})}function l(t){return Object(s["default"])({url:"/mng/job/updateJob",method:"post",data:t})}function d(t){return Object(s["default"])({url:"/mng/job/deleteJob/"+t,method:"post"})}function u(t){return Object(s["default"])({url:"/mng/job/deleteJobs",method:"post",data:t})}function c(t){return Object(s["default"])({url:"/mng/job/{jobId}/jarList".replace("{jobId}",t),method:"get"})}function g(t){return Object(s["default"])({url:"/mng/job/startJob/{jobId}".replace("{jobId}",t),method:"get"})}function p(t){return Object(s["default"])({url:"/mng/job/startJobs",method:"post",data:t})}function h(t){return Object(s["default"])({url:"/mng/job/reStartJob/{jobId}".replace("{jobId}",t),method:"get"})}function f(t){return Object(s["default"])({url:"/mng/job/reStartJobs",method:"post",data:t})}function m(t){return Object(s["default"])({url:"/mng/job/stopJob/{jobId}".replace("{jobId}",t),method:"get"})}function b(t){return Object(s["default"])({url:"/mng/job/stopJobs",method:"post",data:t})}},"782f":function(t,e,a){"use strict";a.r(e),a.d(e,"getInstStatusList",(function(){return i})),a.d(e,"getJobTypeList",(function(){return n})),a.d(e,"getJobClientVersionList",(function(){return o})),a.d(e,"getDefaultFlinkConfs",(function(){return r}));var s=a("b775");function i(){return Object(s["default"])({url:"/mng/enum/jobInstanceStatus",method:"get"})}function n(){return Object(s["default"])({url:"/mng/enum/jobType",method:"get"})}function o(){return Object(s["default"])({url:"/mng/enum/jobClientVersion",method:"get"})}function r(){return Object(s["default"])({url:"/mng/util/defaultFlinkConfs",method:"get"})}},"8e81":function(t,e,a){},a7f5:function(t,e,a){"use strict";a.r(e),a.d(e,"getInstPageList",(function(){return i})),a.d(e,"getInstLog",(function(){return n}));var s=a("b775");function i(t){return Object(s["default"])({url:"/mng/jobInstance/queryJobInstances",method:"get",params:t})}function n(t){return Object(s["default"])({url:"/mng/jobInstance/startLog/"+t,method:"get"})}},bf3b:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticStyle:{"margin-bottom":"10px",padding:"5px","background-image":"linear-gradient(100deg, rgba(60, 213, 255, 0.5), rgba(60, 213, 255, 0.3))"}},[a("a-row",{attrs:{gutter:16}},[a("a-col",{staticClass:"gutter-row",staticStyle:{"padding-left":"20px"},attrs:{span:14}},[a("div",{staticClass:"gutter-box"},[a("span",[t._v("ID : "),a("a-input",{staticStyle:{width:"100px"},attrs:{placeholder:"eg. 1001",size:"small",allowClear:""},model:{value:t.dataFilter.id,callback:function(e){t.$set(t.dataFilter,"id",e)},expression:"dataFilter.id"}})],1),a("span",{staticStyle:{"margin-left":"10px"}},[t._v("状态 : "),a("a-select",{staticStyle:{width:"100px"},attrs:{size:"small",allowClear:""},on:{change:t.getDataList},model:{value:t.dataFilter.status,callback:function(e){t.$set(t.dataFilter,"status",e)},expression:"dataFilter.status"}},t._l(t.helper.instStatusList,(function(e,s){return a("a-select-option",{key:s,attrs:{value:e.value}},[t._v(" "+t._s(e.desc)+" ")])})),1)],1)])]),a("a-col",{staticClass:"gutter-row",attrs:{span:10,align:"right"}},[a("div",{staticClass:"gutter-box"},[a("a-tooltip",{attrs:{title:"周期刷新"}},[a("a-switch",{attrs:{"checked-children":"开","un-checked-children":"关"},on:{change:t.handleDataListFlush},model:{value:t.helper.isAutoFlush,callback:function(e){t.$set(t.helper,"isAutoFlush",e)},expression:"helper.isAutoFlush"}})],1),a("a-button",{staticClass:"filter-tool",attrs:{type:"primary",size:"small"},on:{click:t.onQuery}},[t._v("查询")]),a("a-button",{staticClass:"filter-tool",attrs:{type:"primary",size:"small"},on:{click:t.onGoBack}},[t._v("返回")])],1)])],1)],1),a("div",[a("a-table",{attrs:{columns:t.dataColumnList,"data-source":t.dataList,rowKey:function(t){return t.id},loading:t.isLoading,pagination:!1,scroll:{x:1920}},scopedSlots:t._u([{key:"jobName",fn:function(e,s){return a("span",{},[t._v(" "+t._s(s.job.name)+" ")])}},{key:"jobType",fn:function(e,s){return a("span",{},[t._v(" "+t._s(s.job.typeDesc)+" ")])}},{key:"appId",fn:function(e,s){return a("span",{},[a("a",{attrs:{href:s.uiAddress,target:"_blank"}},[t._v(t._s(e))])])}},{key:"statusDesc",fn:function(e,s){return a("span",{},[a("span",{style:{color:[3,4,-1].includes(s.status)?"red":"green"}},[t._v(t._s(e))])])}},{key:"action",fn:function(e){return a("span",{},[a("a",{on:{click:function(a){return t.onLog(e)}}},[t._v("日志")]),a("a-divider",{attrs:{type:"vertical"}}),a("router-link",{attrs:{to:{path:"inst/instDetail",query:{instId:e.id}},disabled:""}},[t._v("详情")])],1)}}])})],1),a("div",{staticStyle:{"margin-top":"10px",padding:"5px","background-image":"linear-gradient(100deg, rgba(60,213,255,0.30), rgba(60,213,255,0.20))"}},[a("row",[a("a-row",{attrs:{gutter:16}},[a("a-col",{staticClass:"gutter-row",attrs:{span:12}},[a("div",{staticClass:"gutter-box"},[a("span",{staticStyle:{"font-size":"16px"}},[t._v("周期刷新 : ")]),a("a-switch",{attrs:{"checked-children":"开","un-checked-children":"关"},on:{change:t.handleDataListFlush},model:{value:t.helper.isAutoFlush,callback:function(e){t.$set(t.helper,"isAutoFlush",e)},expression:"helper.isAutoFlush"}})],1)]),a("a-col",{staticClass:"gutter-row",attrs:{span:12,align:"right"}},[a("div",{staticClass:"gutter-box"},[a("a-pagination",{attrs:{size:"small",pageSizeOptions:["1","2","10","20","30","40","50","100","500","1000"],total:t.page.total,"show-total":function(e,a){return"第 "+a[0]+" ~ "+a[1]+" 项，共 "+t.page.total+" 项"},"show-size-changer":"","show-quick-jumper":""},on:{change:t.onPageNumChange,showSizeChange:t.onPageSizeChange}})],1)])],1)],1)],1),a("a-modal",{attrs:{title:"实例日志",width:.8*t.helper.clientWidth},on:{ok:t.handleInstLogModalOk,cancel:t.handleInstLogModalCancel},model:{value:t.instLog.isVisible,callback:function(e){t.$set(t.instLog,"isVisible",e)},expression:"instLog.isVisible"}},[a("SqlCMEditor",{attrs:{"read-only":!0,"auto-scroll-to-bottom-on-changes":!0},model:{value:t.instLog.data,callback:function(e){t.$set(t.instLog,"data",e)},expression:"instLog.data"}})],1)],1)},i=[],n=(a("caad"),a("a7f5")),o=a("782f"),r=a("fa7d"),l=a("1a8a"),d={components:{SqlCMEditor:l["default"]},name:"InstList",props:{jobId:{default:null},isAutoFlush:{default:!1}},data:function(){return{dataFilter:{id:null,jobId:this.jobId,status:"",pageNum:1,pageSize:10},dataColumnList:[{title:"ID",dataIndex:"id",width:80},{title:"名称",width:200,scopedSlots:{customRender:"jobName"}},{title:"类型",width:100,scopedSlots:{customRender:"jobType"}},{title:"创建时间",dataIndex:"createTime",width:170},{title:"开始时间",dataIndex:"startTime",width:170},{title:"结束时间",dataIndex:"stopTime",width:170},{title:"Flink UI",dataIndex:"appId",width:280,scopedSlots:{customRender:"appId"}},{title:"状态",dataIndex:"statusDesc",width:100,align:"center",fixed:"right",scopedSlots:{customRender:"statusDesc"}},{title:"操作",width:130,align:"center",fixed:"right",scopedSlots:{customRender:"action"}}],dataList:[],dataTableSelectedRowKeys:[],isLoading:!1,instLog:{isVisible:!1,data:"",timer:null},page:{total:0},dataListTimer:null,helper:{jobTypeList:[],instStatusList:[],isAutoFlush:this.isAutoFlush,clientWidth:document.documentElement.clientWidth}}},methods:{onQuery:function(){this.getDataList()},onEdit:function(){},onGoBack:function(){this.$router.go(-1)},onDataTableSelectedChange:function(t){this.dataTableSelectedRowKeys=t},onPageNumChange:function(t,e){this.dataFilter.pageNum=t,this.getDataList()},onPageSizeChange:function(t,e){this.dataFilter.pageNum=t,this.dataFilter.pageSize=e,this.getDataList()},getDataList:function(){var t=this;this.isLoading=!0,n["getInstPageList"](r["objectDeleteBlankVK"](this.dataFilter)).then((function(e){t.isLoading=!1,t.dataList=e.data.list,t.page.total=e.data.total;var a=t.dataList[0];a&&([3,4,5,6].includes(a.status)?t.handleDataListFlush(!1):(t.helper.isAutoFlush=!0,t.handleDataListFlush(!0)))}))},handleInstLogModalOk:function(){this.instLog.isVisible=!1,this.clearInstLogTimer()},handleInstLogModalCancel:function(){this.clearInstLogTimer()},handleDataListFlush:function(t){t?this.dataListTimer||(this.dataListTimer=this.getDataListTimer()):this.clearDataListTimer()},getDataListTimer:function(){var t=this;return setInterval((function(){t.getDataList()}),1e3)},clearDataListTimer:function(){clearInterval(this.dataListTimer),this.dataListTimer=null,this.helper.isAutoFlush=!1},handleInstLogFlush:function(t,e){t?this.instLog.timer||(this.instLog.timer=this.getInstLogTimer(e)):this.clearInstLogTimer()},getInstLogTimer:function(t){var e=this;return setInterval((function(){e.getInstLog(t)}),1e3)},clearInstLogTimer:function(){clearInterval(this.instLog.timer),this.instLog.timer=null},getInstLog:function(t){var e=this;n["getInstLog"](t.id).then((function(t){e.instLog.data=t.data}))},initHelper:function(){var t=this;o["getJobTypeList"]().then((function(e){t.helper.jobTypeList=e.data})),o["getInstStatusList"]().then((function(e){t.helper.instStatusList=e.data}))},onLog:function(t){this.instLog.data="",this.instLog.isVisible=!0,this.handleInstLogFlush(!0,t)}},beforeDestroy:function(){this.clearDataListTimer(),this.clearInstLogTimer()},created:function(){this.initHelper(),this.getDataList()}},u=d,c=(a("dc9a"),a("2877")),g=Object(c["a"])(u,s,i,!1,null,"c17f56a2",null);e["default"]=g.exports},dc9a:function(t,e,a){"use strict";var s=a("8e81"),i=a.n(s);i.a},fe70:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[a("a-page-header",{staticStyle:{padding:"5px 5px 0 5px"},attrs:{title:t.usageModeHelper.title,"sub-title":t.usageModeHelper.subTitle},on:{back:function(){return t.$router.go(-1)}}},[a("template",{slot:"tags"},[a("a-tag",{directives:[{name:"show",rawName:"v-show",value:t.data.lastStatusDesc,expression:"data.lastStatusDesc"}],style:{color:[3,4,-1].includes(t.data.lastStatus)?"red":"green"}},[t._v(t._s(t.data.lastStatusDesc))])],1),a("template",{slot:"extra"},[a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.usageModeHelper.showStartButton,expression:"usageModeHelper.showStartButton"}],staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small",disabled:!t.data.authMap.start},on:{click:t.onStart}},[t._v("启动")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.usageModeHelper.showStopButton,expression:"usageModeHelper.showStopButton"}],staticStyle:{"margin-right":"5px"},attrs:{type:"danger",size:"small",disabled:!t.data.authMap.stop},on:{click:t.onStop}},[t._v("停止")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.usageModeHelper.showEditButton,expression:"usageModeHelper.showEditButton"}],staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small",disabled:!t.data.authMap.edit},on:{click:t.onEdit}},[t._v("编辑")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.usageModeHelper.showUpdateButton,expression:"usageModeHelper.showUpdateButton"}],staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:t.onUpdate}},[t._v("更新")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.usageModeHelper.showDetailButton,expression:"usageModeHelper.showDetailButton"}],staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:t.onDetail}},[t._v("详情")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.usageModeHelper.showDeleteButton,expression:"usageModeHelper.showDeleteButton"}],staticStyle:{"margin-right":"5px"},attrs:{type:"danger",size:"small",disabled:!t.data.authMap.delete},on:{click:t.onDelete}},[t._v("删除")]),a("a-button",{attrs:{type:"primary",size:"small"},on:{click:t.onGoBack}},[t._v("返回")])],1)],2)],1),a("a-tabs",{on:{change:t.handleTabChange},model:{value:t.helper.activeKey,callback:function(e){t.$set(t.helper,"activeKey",e)},expression:"helper.activeKey"}},[a("a-tab-pane",{key:"job"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("a-icon",{attrs:{type:"file-text"}}),t._v(" 作业信息 ")],1),a("a-spin",{attrs:{spinning:t.usageModeHelper.isLoading,size:"large"}},[a("div",{staticStyle:{"margin-top":"20px"}},[a("h2",[t._v("基本配置")]),a("a-form-model",{ref:"ruleForm",attrs:{model:t.data,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[a("a-form-model-item",{attrs:{label:"作业名称",prop:"name"}},[["add","edit"].includes(t.usageMode)?a("a-input",{model:{value:t.data.name,callback:function(e){t.$set(t.data,"name",e)},expression:"data.name"}}):["detail"].includes(t.usageMode)?a("span",[t._v(t._s(t.data.name))]):t._e()],1),a("a-form-model-item",{attrs:{label:"作业类型",prop:"type"}},[["add","edit"].includes(t.usageMode)?a("a-select",{attrs:{placeholder:"请选择作业类型",disabled:""},model:{value:t.data.type,callback:function(e){t.$set(t.data,"type",e)},expression:"data.type"}},t._l(t.helper.jobTypeList,(function(e,s){return a("a-select-option",{key:s,attrs:{value:e.value}},[t._v(" "+t._s(e.desc)+" ")])})),1):["detail"].includes(t.usageMode)?a("span",[t._v(t._s(t.data.typeDesc))]):t._e()],1),a("a-form-model-item",{attrs:{label:"作业描述"}},[a("a-textarea",{model:{value:t.data.description,callback:function(e){t.$set(t.data,"description",e)},expression:"data.description"}})],1),a("H2",[t._v("作业配置")]),a("a-form-model-item",{attrs:{label:"主节点内存",prop:"flinkConfigJobManagerMemory"}},[["add","edit"].includes(t.usageMode)?a("a-input",{model:{value:t.data.flinkConfig.jobManagerMemory,callback:function(e){t.$set(t.data.flinkConfig,"jobManagerMemory",e)},expression:"data.flinkConfig.jobManagerMemory"}}):["detail"].includes(t.usageMode)?a("span",[t._v(t._s(t.data.flinkConfig.jobManagerMemory))]):t._e()],1),a("a-form-model-item",{attrs:{label:"执行节点内存",prop:"flinkConfigTaskManagerMemory"}},[["add","edit"].includes(t.usageMode)?a("a-input",{model:{value:t.data.flinkConfig.taskManagerMemory,callback:function(e){t.$set(t.data.flinkConfig,"taskManagerMemory",e)},expression:"data.flinkConfig.taskManagerMemory"}}):["detail"].includes(t.usageMode)?a("span",[t._v(t._s(t.data.flinkConfig.taskManagerMemory))]):t._e()],1),a("a-form-model-item",{attrs:{label:"Slot 数/节点",prop:"flinkConfigTaskManagerSlots"}},[["add","edit"].includes(t.usageMode)?a("a-input-number",{attrs:{min:1},model:{value:t.data.flinkConfig.taskManagerSlots,callback:function(e){t.$set(t.data.flinkConfig,"taskManagerSlots",e)},expression:"data.flinkConfig.taskManagerSlots"}}):["detail"].includes(t.usageMode)?a("span",[t._v(t._s(t.data.flinkConfig.taskManagerSlots))]):t._e()],1),a("a-form-model-item",{attrs:{label:"作业并行度",prop:"flinkConfigParallelism"}},[["add","edit"].includes(t.usageMode)?a("a-input-number",{attrs:{min:1},model:{value:t.data.flinkConfig.parallelism,callback:function(e){t.$set(t.data.flinkConfig,"parallelism",e)},expression:"data.flinkConfig.parallelism"}}):["detail"].includes(t.usageMode)?a("span",[t._v(t._s(t.data.flinkConfig.parallelism))]):t._e()],1),a("a-form-model-item",{attrs:{label:"是否重试",prop:"isRetry"}},[a("a-switch",{attrs:{"checked-children":"开","un-checked-children":"关"},model:{value:t.data.flinkConfig.isRetry,callback:function(e){t.$set(t.data.flinkConfig,"isRetry",e)},expression:"data.flinkConfig.isRetry"}})],1),a("a-form-model-item",{attrs:{label:"Flink 参数",prop:"flinkConfigConfigs"}},[a("a-textarea",{attrs:{autoSize:{minRows:7},placeholder:"flink.conf.key1=value1\nflink.conf.key2=value2\nflink.conf.key3=value3"},model:{value:t.data.flinkConfig.configsStr,callback:function(e){t.$set(t.data.flinkConfig,"configsStr",e)},expression:"data.flinkConfig.configsStr"}}),t._l(t.helper.defaultFlinkConfs,(function(e,s){return a("div",{key:s},[t._v(t._s(s+"="+e))])}))],2),a("a-form-model-item",{attrs:{"wrapper-col":{span:t.wrapperCol.span,offset:t.labelCol.span}}},[a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.usageModeHelper.showAddButton,expression:"usageModeHelper.showAddButton"}],attrs:{type:"primary"},on:{click:t.onAdd}},[t._v(" 新建 ")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.usageModeHelper.showUpdateButton,expression:"usageModeHelper.showUpdateButton"}],attrs:{type:"primary"},on:{click:t.onUpdate}},[t._v(" 更新 ")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.usageModeHelper.showRest,expression:"usageModeHelper.showRest"}],staticStyle:{"margin-left":"10px"},on:{click:t.onRest}},[t._v(" 清空 ")])],1)],1)],1)])],1),a("a-tab-pane",{key:"sql"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("a-icon",{attrs:{type:"database"}}),t._v(" Flink SQL ")],1),a("SqlCMEditor",{attrs:{height:"700","read-only":t.usageModeHelper.editorReadOnly},model:{value:t.data.extraConfig.sql,callback:function(e){t.$set(t.data.extraConfig,"sql",e)},expression:"data.extraConfig.sql"}})],1),["detail"].includes(t.usageMode)?a("a-tab-pane",{key:"instList"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("a-icon",{attrs:{type:"database"}}),t._v(" 实例列表 ")],1),a("InstList",{ref:"refInstList",attrs:{"job-id":t.dataId,"is-auto-flush":!0}})],1):t._e()],1)],1)},i=[],n=(a("a4d3"),a("e01a"),a("99af"),a("4160"),a("caad"),a("b0c0"),a("4fad"),a("ac1f"),a("5319"),a("1276"),a("159b"),a("76fe")),o=a("782f"),r=a("bf3b"),l=a("1a8a"),d={components:{InstList:r["default"],SqlCMEditor:l["default"]},name:"JobSqlAddEditDetail",props:{usageMode:{default:""},dataId:{default:-1}},computed:{jobUploadJarUrl:function(){return n["UPLOAD_JAR_URL"].replace("{jobId}",this.dataId)}},watch:{data:{deep:!0,handler:function(){"edit"!==this.usageMode&&"detail"!==this.usageMode||(this.usageModeHelper.title=this.data.name,this.usageModeHelper.subTitle=this.data.description)}}},data:function(){return{labelCol:{span:4},wrapperCol:{span:16},data:{id:null,name:"",type:1,lastStatus:null,statusDesc:"",clientVersion:"",flinkConfig:{jobManagerMemory:"1G",taskManagerMemory:"2G",taskManagerSlots:"",parallelism:1,isRetry:!1,configsStr:"",configs:""},extraConfig:{sql:""},authMap:{edit:!1,delete:!1,start:!1,stop:!1,restart:!1}},rules:{name:[{required:!0,message:"请输入作业名！",trigger:"blur"}],type:[{required:!0,message:"请选择作业类型！",trigger:"blur"}]},usageModeHelper:{showPassword:!1,showAddButton:!1,showStartButton:!1,showStopButton:!1,showUpdateButton:!1,showEditButton:!1,showDetailButton:!1,showDeleteButton:!1,showRest:!0,isLoading:!1,editorReadOnly:!0,title:"",subTitle:""},helper:{jobTypeList:[],jobJarList:[],jobClientVersionList:[],activeKey:"job",defaultFlinkConfs:{}},dataTimer:null}},methods:{onAdd:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(!e)return t.$message.error("请检查必填项！！！"),!1;n["addJob"](t.data).then((function(e){t.$router.push({path:"/page/job/jobDetail",query:{jobId:e.data.id}}),t.$Notice.success({title:"新建作业成功！"})}))}))},onUpdate:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(!e)return t.$message.error("请检查必填项"),!1;var a=t.data.flinkConfig.configsStr,s=a?a.split(/[\n]+/):[],i={};s.length>0&&s.forEach((function(t){var e=t.split("="),a=e[0],s=e[1];i[a]=s}));var o={id:t.data.id,name:t.data.name,type:t.data.type,description:t.data.description,flinkConfig:{jobManagerMemory:t.data.flinkConfig.jobManagerMemory,taskManagerMemory:t.data.flinkConfig.taskManagerMemory,taskManagerSlots:t.data.flinkConfig.taskManagerSlots,parallelism:t.data.flinkConfig.parallelism,isRetry:t.data.flinkConfig.isRetry,configs:i},extraConfig:t.data.extraConfig};n["updateJob"](o).then((function(){t.$router.push({path:"/page/job/jobDetail",query:{type:t.data.type,jobId:t.data.id}}),t.$Notice.success({title:"更新作业成功！"})}))}))},onEdit:function(){this.$router.push({path:"/page/job/jobEdit",query:{type:this.data.type,jobId:this.data.id}})},onDetail:function(){this.$router.push({path:"/page/job/jobDetail",query:{type:this.data.type,jobId:this.data.id}})},onDelete:function(){var t=this;n["deleteJob"](this.data.id).then((function(){t.$Notice.success({title:"删除作业成功！"}),t.$router.push({path:"/page/job/jobList"})}))},onStart:function(){var t=this;n["startJob"](this.data.id).then((function(){t.$Notice.success({title:"启动作业成功！"}),t.handleFlush(!0),"instList"===t.helper.activeKey&&t.$refs.refInstList.getDataList()}))},onStop:function(){var t=this;n["stopJob"](this.data.id).then((function(){t.$Notice.success({title:"停止作业成功！"}),t.getData()}))},handleFlush:function(t){t?this.dataTimer||(this.dataTimer=this.getDataTimer()):this.clearDataTimer()},getDataTimer:function(){var t=this;return setInterval((function(){t.getData()}),1e3)},clearDataTimer:function(){clearInterval(this.dataTimer),this.dataTimer=null},onRest:function(){this.data={}},handleJarUploadChange:function(t){"done"===t.file.status?(this.$message.success("".concat(t.file.name," 上传成功！")),this.getJobUploadJarList()):"error"===t.file.status&&this.$message.error("".concat(t.file.name," 上传失败！"))},onGoBack:function(){this.$router.go(-1)},handleTabChange:function(t){"instList"!==t?this.$refs.refInstList&&this.$refs.refInstList.clearDataListTimer():this.$refs.refInstList&&this.$refs.refInstList.getDataList()},initAddUsageModel:function(){this.usageModeHelper.showAddButton=!0,this.usageModeHelper.showUpdateButton=!1,this.usageModeHelper.showPassword=!0,this.usageModeHelper.title="新建作业",this.usageModeHelper.subTitle="请仔细核对作业信息哟！"},initEditUsageModel:function(){this.usageModeHelper.isLoading=!0,this.usageModeHelper.showAddButton=!1,this.usageModeHelper.showUpdateButton=!0,this.usageModeHelper.showPassword=!0,this.usageModeHelper.showPassword=!0,this.usageModeHelper.showDetailButton=!0,this.usageModeHelper.showStartButton=!1,this.usageModeHelper.showStopButton=!1,this.usageModeHelper.editorReadOnly=!1,this.usageModeHelper.title="编辑作业",this.usageModeHelper.subTitle="请仔细核对作业信息哟！"},initDetailUsageModel:function(){this.usageModeHelper.showAddButton=!1,this.usageModeHelper.showUpdateButton=!1,this.usageModeHelper.showPassword=!1,this.usageModeHelper.showRest=!1,this.usageModeHelper.showEditButton=!0,this.usageModeHelper.showDeleteButton=!0,this.usageModeHelper.showStartButton=!0,this.usageModeHelper.showStopButton=!0,this.usageModeHelper.editorReadOnly=!0,this.usageModeHelper.title="作业详情",this.usageModeHelper.subTitle="请仔细核对作业信息哟！"},getData:function(){var t=this;this.usageModeHelper.isLoading=!0,n["getJob"](this.dataId).then((function(e){t.usageModeHelper.isLoading=!1,t.data=e.data,t.data["extraConfig"].sql||(t.data["extraConfig"]={sql:""});var a="";if(t.data.flinkConfig.configs){var s=0;Object.entries(t.data.flinkConfig.configs).forEach((function(t){s>0&&(a+="\n"),a+="".concat(t[0],"=").concat(t[1]),s+=1}))}t.data.flinkConfig.configsStr=a,[3,4,5,6].includes(t.data.lastStatus)&&t.clearDataTimer()}))},getJobUploadJarList:function(){var t=this;n["getJobJarList"](this.dataId).then((function(e){t.helper.jobJarList=e.data}))},initHelper:function(){var t=this;o["getJobTypeList"]().then((function(e){t.helper.jobTypeList=e.data})),o["getJobClientVersionList"]().then((function(e){t.helper.jobClientVersionList=e.data})),o["getDefaultFlinkConfs"]().then((function(e){t.helper.defaultFlinkConfs=e.data})),this.getJobUploadJarList()},initUsageModel:function(){switch(this.usageMode){case"add":this.initAddUsageModel();break;case"edit":this.getData(),this.initEditUsageModel();break;case"detail":this.getData(),this.initDetailUsageModel();break}},beforeDestroy:function(){this.clearDataTimer()},init:function(){this.initHelper(),this.initUsageModel()}},created:function(){this.init()}},u=d,c=a("2877"),g=Object(c["a"])(u,s,i,!1,null,"69003129",null);e["default"]=g.exports}}]);
//# sourceMappingURL=chunk-6773f6c4.a9257f3c.js.map